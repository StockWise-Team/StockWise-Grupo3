<div class="h-full flex flex-col">
  <!-- Header -->
  <div class="flex items-center gap-4 mb-4">
    <h2 class="text-xl font-semibold">Venta en Proceso</h2>

    <!-- Search box in header -->
    <div class="flex-1 relative">
      <input
        type="text"
        placeholder="Buscar producto..."
        class="w-full max-w-md border rounded px-3 py-2 text-sm"
        [(ngModel)]="searchQuery"
        (input)="onSearch()" />

      <!-- Suggestions dropdown -->
      <div *ngIf="suggestions.length" class="absolute z-10 mt-1 border rounded bg-white shadow-md max-w-md max-h-48 overflow-auto">
        <button
          *ngFor="let prod of suggestions"
          type="button"
          class="w-full text-left px-3 py-2 hover:bg-gray-100 text-sm border-b last:border-b-0"
          (click)="onSelectProduct(prod)">
          {{ prod.name }} - {{ prod.unitPrice | currency:'ARS' }}
        </button>
      </div>
    </div>

    <button
      class="px-4 py-2 rounded border border-gray-300 hover:bg-gray-50"
      (click)="onCancelSale()">
      Cancelar Venta
    </button>
  </div>

  <!-- Main content area -->
  <div class="flex-1 flex flex-col border rounded-lg p-4 bg-white overflow-hidden">

    <!-- Products list -->
    <div class="flex-1 overflow-auto">
      <div *ngIf="!items.length" class="text-center text-gray-500 py-8">
        Aún no se han agregado productos
      </div>

      <div *ngFor="let item of items; let i = index" class="flex items-center gap-3 border-b py-3">
        <!-- Image placeholder -->
        <div class="w-16 h-16 bg-gray-200 rounded flex items-center justify-center text-gray-400 text-xs flex-shrink-0">
          IMG
        </div>

        <!-- Product name -->
        <div class="flex-1 min-w-0">
          <div class="font-medium truncate">{{ item.product.name }}</div>
        </div>

        <!-- Quantity controls -->
        <div class="flex items-center gap-2">
          <button
            class="w-7 h-7 rounded border hover:bg-gray-100 flex items-center justify-center"
            (click)="decreaseQty(i)">
            -
          </button>
          <span class="w-8 text-center">{{ item.quantity }}</span>
          <button
            class="w-7 h-7 rounded border hover:bg-gray-100 flex items-center justify-center"
            (click)="increaseQty(i)">
            +
          </button>
        </div>

        <!-- Unit price -->
        <div class="text-sm text-gray-600 w-24 text-right">
          <div class="text-xs text-gray-500">precio unitario</div>
          <div>{{ item.product.unitPrice | currency:'ARS':'symbol':'1.0-0' }}</div>
        </div>

        <!-- Subtotal -->
        <div class="text-sm font-medium w-24 text-right">
          <div class="text-xs text-gray-500">precio</div>
          <div>{{ item.subtotal | currency:'ARS':'symbol':'1.0-0' }}</div>
        </div>

        <!-- Remove button -->
        <button
          class="text-red-600 hover:text-red-800 ml-2"
          (click)="removeItem(i)">
          ✕
        </button>
      </div>
    </div>

    <!-- Total -->
    <div class="border-t pt-3 mt-3 flex justify-between items-center">
      <span class="text-lg font-semibold">TOTAL</span>
      <span class="text-xl font-bold">{{ totalAmount | currency:'ARS':'symbol':'1.0-0' }}</span>
    </div>
  </div>

  <!-- Footer: Finish Sale button -->
  <div class="mt-4 flex justify-end">
    <button
      class="px-6 py-2 rounded bg-primary-600 text-white hover:bg-primary-700 disabled:opacity-50 disabled:cursor-not-allowed"
      [disabled]="!items.length"
      (click)="onFinishSale()">
      Finalizar Venta
    </button>
  </div>
</div>

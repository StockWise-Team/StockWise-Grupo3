<div class="flex items-center gap-3 mb-4">
  <h2 class="text-xl font-semibold flex-1 text-gray-900">Ventas de Hoy</h2>

  <!-- Estado de la caja -->
  <div class="text-sm">
    <span *ngIf="cashIsOpen" class="text-green-600 font-medium"> Caja Abierta</span>
    <span *ngIf="!cashIsOpen" class="text-red-600 font-medium"> Caja Cerrada</span>
  </div>

  <!-- Botón Realizar Venta - Solo aparece cuando la caja está abierta -->
  <button
    *ngIf="cashIsOpen"
    (click)="onMakeSale()"
    class="px-3 py-2 rounded bg-primary-600 text-white hover:bg-primary-700"
    title="Realizar nueva venta">
    Realizar Venta
  </button>
</div>

<div class="border rounded-lg overflow-hidden bg-white shadow-sm">
  <!-- Encabezados de la tabla -->
  <div class="bg-gray-50 border-b px-4 py-3">
    <div class="flex items-center gap-4">
      <!-- Espacio para ícono de expansión -->
      <div class="w-5 h-5"></div>

      <!-- Encabezados de las columnas -->
      <div class="flex-1 grid grid-cols-5 gap-4">
        <div class="text-xs font-medium text-gray-600 uppercase tracking-wider">
          Nº Venta / Fecha
        </div>
        <div class="text-xs font-medium text-gray-600 uppercase tracking-wider">
          Empleado
        </div>
        <div class="text-xs font-medium text-gray-600 uppercase tracking-wider text-center">
          Productos
        </div>
        <div class="text-xs font-medium text-gray-600 uppercase tracking-wider text-right">
          Total
        </div>
        <div class="text-xs font-medium text-gray-600 uppercase tracking-wider text-center">
          Estado
        </div>
      </div>
    </div>
  </div>

  <!-- Lista de ventas agrupadas -->
  <div *ngIf="groupedSales.length; else noSales">
    <div *ngFor="let sale of groupedSales; let i = index"
         class="border-b last:border-b-0">

      <!-- Fila principal de la venta (clickeable para expandir) -->
  <div class="px-4 py-3 hover:bg-gray-50 cursor-pointer flex items-center gap-4 transition"
           (click)="toggleSaleExpansion(sale.id)">

        <!-- Ícono de expansión -->
        <div class="w-5 h-5 flex items-center justify-center text-gray-400">
          <span *ngIf="!sale.expanded">▶</span>
          <span *ngIf="sale.expanded">▼</span>
        </div>

        <!-- Información principal de la venta -->
        <div class="flex-1 grid grid-cols-5 gap-4 items-center">
          <!-- Número de venta -->
          <div>
            <div class="font-semibold text-sm text-blue-600">{{ sale.saleNumber }}</div>
            <div class="text-xs text-gray-500">{{ formatDate(sale.date) }}</div>
          </div>

          <!-- Usuario -->
          <div>
            <div class="text-sm text-gray-800">{{ sale.userName || 'N/A' }}</div>
          </div>

          <!-- Cantidad de artículos -->
          <div class="text-center">
            <div class="text-sm font-medium text-gray-800">{{ sale.details.length }} productos</div>
            <div class="text-xs text-gray-500">{{ sale.itemCount }} unidades</div>
          </div>

          <!-- Monto total -->
          <div class="text-right">
            <div class="font-bold text-green-600 text-lg">{{ sale.totalAmount | currency:'ARS':'symbol':'1.0-0' }}</div>
          </div>

          <!-- Estado (siempre completada) -->
          <div class="text-center">
            <span class="px-3 py-1 rounded-full text-xs font-medium bg-green-100 text-green-700">
              ✓ Completada
            </span>
          </div>
        </div>
      </div>

      <!-- Detalles expandibles -->
  <div *ngIf="sale.expanded" class="px-4 pb-3 bg-gray-50">
        <div class="border-t pt-3">
          <h4 class="text-sm font-medium mb-2 text-gray-700">Detalles de la venta:</h4>

          <!-- Encabezados para detalles de productos -->
          <div class="flex items-center justify-between bg-gray-100 px-3 py-2 rounded text-xs font-medium text-gray-600 uppercase tracking-wider">
            <div class="flex-1">Producto</div>
            <div class="text-center w-20">Cantidad</div>
            <div class="text-right w-24">Precio Unit.</div>
            <div class="text-right w-24">Subtotal</div>
          </div>

          <!-- Lista de productos -->
          <div class="space-y-1 mt-2">
      <div *ngFor="let detail of sale.details"
        class="flex items-center justify-between bg-white px-3 py-2 rounded text-sm border border-gray-100">

              <!-- Producto -->
              <div class="flex-1">
                <span class="font-medium text-gray-800">{{ detail.productName }}</span>
              </div>

              <!-- Cantidad -->
              <div class="text-center w-20 font-medium text-blue-600">
                {{ detail.quantity }}x
              </div>

              <!-- Precio unitario -->
              <div class="text-right w-24 text-gray-600">
                {{ detail.unitPrice | currency:'ARS':'symbol':'1.0-0' }}
              </div>

              <!-- Subtotal -->
              <div class="text-right w-24 font-semibold text-gray-800">
                {{ detail.subtotal | currency:'ARS':'symbol':'1.0-0' }}
              </div>
            </div>
          </div>

          <!-- Total de la venta -->
          <div class="mt-3 pt-2 border-t flex justify-between items-center">
            <div class="text-left">
              <div class="text-sm text-gray-600">Número de venta</div>
              <div class="text-lg font-bold text-blue-600">{{ sale.saleNumber }}</div>
            </div>
            <div class="text-right">
              <div class="text-sm text-gray-600">Total de la venta</div>
              <div class="text-lg font-bold">{{ sale.totalAmount | currency:'ARS':'symbol':'1.0-0' }}</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Mensaje cuando no hay ventas -->
  <ng-template #noSales>
    <div class="px-4 py-12 text-center text-gray-500">
      <div class="text-lg mb-2"></div>
      <div class="text-sm">No hay ventas registradas para la caja actual</div>
      <div class="text-xs text-gray-400 mt-1">
        <div>Las ventas aparecerán aquí una vez que realices una venta</div>
        <div class="mt-1">Los números de venta inician en 1 para cada nueva caja</div>
      </div>
    </div>
  </ng-template>
</div>
